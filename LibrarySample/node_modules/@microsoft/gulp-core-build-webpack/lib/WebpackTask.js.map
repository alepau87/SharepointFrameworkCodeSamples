{"version":3,"sources":["WebpackTask.ts"],"names":[],"mappings":"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","file":"WebpackTask.js","sourcesContent":["import * as Webpack from 'webpack';\nimport { GulpTask } from '@microsoft/gulp-core-build';\nimport gulp = require('gulp');\nimport { EOL } from 'os';\n\nexport interface IWebpackTaskConfig {\n  /**\n   * Path to a webpack config. A path to a config takes precidence over the \"config\" ooption.\n   */\n  configPath: string;\n\n  /**\n   * Webpack config object. If a path is specified by \"configPath,\" and it is valid, this option is ignored.\n   */\n  config?: Webpack.Configuration;\n\n  /**\n   * An array of regular expressions or regular expression strings. If a warning matches any of them, it\n   * will not be logged.\n   */\n  suppressWarnings?: (string | RegExp)[];\n}\n\nexport class WebpackTask extends GulpTask<IWebpackTaskConfig> {\n  public name: string = 'webpack';\n\n  public taskConfig: IWebpackTaskConfig = {\n    configPath: './webpack.config.js',\n    suppressWarnings: []\n  };\n\n  public resources: Object = {\n    webpack: require('webpack')\n  };\n\n  public executeTask(gulp: gulp.Gulp, completeCallback: (result?: Object) => void): void {\n    let shouldInitWebpack: boolean = (process.argv.indexOf('--initwebpack') > -1);\n\n    /* tslint:disable:typedef */\n    let path = require('path');\n    /* tslint:enabled:typedef */\n\n    if (shouldInitWebpack) {\n      this.log(\n        'Initializing a webpack.config.js, which bundles lib/index.js ' +\n        'into dist/packagename.js into a UMD module.');\n\n      this.copyFile(path.resolve(__dirname, '..', 'webpack.config.js'));\n      completeCallback();\n    } else {\n      let webpackConfig: Object;\n\n      if (!this.taskConfig.configPath && !this.taskConfig.config) {\n        this.logMissingConfigWarning();\n        completeCallback();\n        return;\n      } else if (this.taskConfig.configPath) {\n        if (this.fileExists(this.taskConfig.configPath)) {\n          try {\n            webpackConfig = require(this.resolvePath(this.taskConfig.configPath));\n          } catch (err) {\n            completeCallback(`Error parsing webpack config: ${ this.taskConfig.configPath }: ${ err }`);\n            return;\n          }\n        } else if (!this.taskConfig.config) {\n          this.logWarning(\n            `The webpack config location '${ this.taskConfig.configPath }' doesn't exist. ` +\n            `Run again using --initwebpack to create a default config, or call ` +\n            `webpack.setConfig({ configPath: null }).`);\n\n          completeCallback();\n          return;\n        } else {\n          webpackConfig = this.taskConfig.config;\n        }\n      } else if (this.taskConfig.config) {\n        webpackConfig = this.taskConfig.config;\n      } else {\n        this.logMissingConfigWarning();\n        completeCallback();\n        return;\n      }\n\n      if (webpackConfig) {\n        let webpack: Webpack.Webpack = require('webpack');\n        let gutil = require('gulp-util');\n        let startTime = new Date().getTime();\n        let outputDir = this.buildConfig.distFolder;\n\n        webpack(\n          webpackConfig,\n          (error, stats) => {\n            if (!this.buildConfig.properties) {\n              this.buildConfig.properties = {};\n            }\n\n            /* tslint:disable:no-string-literal */\n            this.buildConfig.properties['webpackStats'] = stats;\n            /* tslint:enable:no-string-literal */\n\n            let statsResult = stats.toJson({\n              hash: false,\n              source: false\n            });\n\n            if (statsResult.errors && statsResult.errors.length) {\n              this.logError(`'${outputDir}':` + EOL + statsResult.errors.join(EOL) + EOL);\n            }\n\n            if (statsResult.warnings && statsResult.warnings.length) {\n              const unsuppressedWarnings: string[] = [];\n              const warningSuppressonRegexes = (this.taskConfig.suppressWarnings || []).map((regex: string) => {\n                return new RegExp(regex);\n              });\n\n              statsResult.warnings.forEach((warning: string) => {\n                let suppressed = false;\n                for (let i = 0; i < warningSuppressonRegexes.length; i++) {\n                  const suppressionRegex = warningSuppressonRegexes[i];\n                  if (warning.match(suppressionRegex)) {\n                    suppressed = true;\n                    break;\n                  }\n                }\n\n                if (!suppressed) {\n                  unsuppressedWarnings.push(warning);\n                }\n              });\n\n              if (unsuppressedWarnings.length > 0) {\n                this.logWarning(`'${outputDir}':` + EOL + unsuppressedWarnings.join(EOL) + EOL);\n              }\n            }\n\n            let duration = (new Date().getTime() - startTime);\n            let statsResultChildren = statsResult.children ? statsResult.children : [ statsResult ];\n\n            statsResultChildren.forEach(child => {\n              if (child.chunks) {\n                child.chunks.forEach(chunk => {\n                  if (chunk.files) {\n                    chunk.files.forEach(file => (\n                      this.log(`Bundled: '${gutil.colors.cyan(path.basename(file))}', ` +\n                        `size: ${gutil.colors.magenta(chunk.size)} bytes, ` +\n                        `took ${gutil.colors.magenta(duration)} ms.`)\n                    )); // end file\n                  }\n                }); // end chunk\n              }\n            }); // end child\n\n            completeCallback();\n          }); // endwebpack callback\n      }\n    }\n  }\n\n  private logMissingConfigWarning() {\n    this.logWarning(\n      'No webpack config has been provided.' +\n      'Run again using --initwebpack to create a default config,' +\n      `or call webpack.setConfig({ configPath: null }).`);\n  }\n}"],"sourceRoot":"/src"}